## 一、概述

[正则表达式](<https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions>)（Regular_Expressions）用于匹配字符串中字符组合的模式。在 JavaScript中，正则表达式也是对象。这些模式被用于 [`RegExp`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/RegExp) 的 [`exec`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec) 和 [`test`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test) 方法, 以及 [`String`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/String) 的 [`match`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/match)、[`matchAll`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/matchAll)、[`replace`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace)、[`search`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/search) 和 [`split`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/split) 方法。本章介绍 JavaScript 正则表达式。



## 二、创建正则表达式

新建正则表达式有两种方法。一种是使用字面量，以斜杠表示开始和结束;另一种是使用RegExp构造函数。

```javascript
// 1、使用字面量
var r2 = /CHINA/;

// 2、使用RegExp构造函数
var r1 = new RegExp("CHINA");
```

上面两种写法是等价的，都新建了一个内容为 `CHINA` 的正则表达式对象。它们的主要区别是，第一种方法在编译时新建正则表达式，第二种方法在运行时新建正则表达式。考虑到书写的便利和直观，实际应用中，基本上都采用字面量的写法。

正则表达式还可以接受第二个参数，表示修饰符（详细解释见下文）。

```javascript
var r1 = /CHINA/i;
// 等价于
var r2 = new RegExp("CHINA", "i");
```

正则对象生成以后，有两种使用方式：

> - 正则对象的方法：将字符串作为参数，比如 `regex.test(string)`。
> - 字符串对象的方法：将正则对象作为参数，比如 `string.match(regex)`。



## 三、正则属性和方法

### 3.1 属性

正则对象的属性分成两类。

一类是修饰符相关，返回一个布尔值，表示对应的修饰符是否设置，ES6新增了`y` 修饰符与`u`修饰符。

- **ignoreCase**：返回一个布尔值，表示是否设置了i修饰符，用于 **忽略大小写** ，该属性只读。
- **global**：返回一个布尔值，表示是否设置了g修饰符，用于 **全局匹配** ，该属性只读。
- **multiline**：返回一个布尔值，表示是否设置了m修饰符，用于 **多行模式匹配** ，该属性只读。

```javascript
var r = /abc/igm;

r.ignoreCase // true
r.global     // true
r.multiline  // true
```

另一类是与修饰符无关的属性，主要是下面两个。

- **lastIndex**：返回下一次开始搜索的位置。该属性可读写，但是只在设置了 `g` 修饰符时有意义。
- **source**：返回正则表达式的字符串形式（不包括反斜杠），该属性只读。



### 3.2 方法

#### a. test()

正则对象的`test`方法返回一个布尔值，表示当前模式是否能匹配参数字符串。

```javascript
// 1、检测字符串是否包含‘@’
let str = "gladius777@163.com"
let reg = /@/
console.log(reg.test(str))	// true

// 2、检测字符串是否包含‘@’
let str = "How are you? Fine, thank you ,and you?"
let reg = /@/
console.log(reg.test(str))	// false
```

如果正则表达式带有`g` 修饰符，则每一次**test**方法都从上一次结束的位置开始向后匹配。

```javascript
let str = "How are you? Fine, thank you ,and you?"
let reg = /o/ig
console.log(reg.test(str))	// true
console.log(reg.lastIndex)	// 2

console.log(reg.test(str))	// true
console.log(reg.lastIndex)	// 10

console.log(reg.test(str))	// true
console.log(reg.lastIndex)	// 27

console.log(reg.test(str))	// true
console.log(reg.lastIndex)	// 36

console.log(reg.test(str))	// false
console.log(reg.lastIndex)	// 0

console.log(reg.test(str))	// true
console.log(reg.lastIndex)	// 2
```

上面代码的正则对象使用了 `g` 修饰符，表示要记录搜索位置。接着，六次使用**test**方法，每一次开始搜索的位置都是上一次匹配的后一个位置。带有 `g` 修饰符时，可以通过正则对象的 **lastIndex** 属性指定开始搜索的位置。

```javascript
let str = "How"
let reg = /o/ig
console.log(reg.test(str))	// true
reg.lastIndex = 2;
console.log(reg.test(str))	// false
```

上面代码指定从字符串的第2个位置开始搜索，这个位置后面是没有字符 `o` 的，所以返回 `false`。

**lastIndex** 属性只对同一个正则表达式有效，所以下面这样写是错误的。

```javascript
var count = 0;
while (/a/g.test('blablabla')) { 
  count++;
}
```

上面代码会导致无限循环，因为 **while** 循环的每次匹配条件都是一个新的正则表达式，导致 **lastIndex** 属性总是等于0。

如果正则模式是一个空字符串，则匹配所有字符串。

```javascript
new RegExp('').test('abc') // true
```

### 